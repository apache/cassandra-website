<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Testing Apache Cassandra 4.0 | Blog</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<link rel="stylesheet" href="/style.css">
		<script src="/init.js"></script>
		
		<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,700;1,400&family=Red+Hat+Display:ital,wght@0,400;0,500;0,700;1,400;1,500&display=swap" rel="stylesheet">
	
			
	
<script async defer data-domain="cassandra.apache.org" src="https://plausible.cassandra.apache.org/js/plausible.js"></script></head>
	<body class="blog-index">
		<div class="container mx-auto">
			<div id="mobile-nav-overlay" class="hide">
				<div class="mobile-nav flex flex-column text-center">
					<a class="mobile-nav-link" href="/cassandra-basics/">Cassandra Basics</a>
					<a class="mobile-nav-link" href="/quickstart/">Quickstart</a>
					<a class="mobile-nav-link" href="/ecosystem/">Ecosystem</a>
					<a class="mobile-nav-link" href="https://cassandra.apache.org/doc/latest/">Documentation</a>
					<a class="mobile-nav-link" href="/community/">Community</a>
					<a class="mobile-nav-link" href="/case-studies/">Case Studies</a>
					<a class="mobile-nav-link" href="/resources/">Resources</a>
					<a class="mobile-nav-link" href="/blog/">Blog</a>
					<a class="mobile-nav-link" href="/download/">Download</a>
				</div>
			</div>
			<header class="grad">
				<div class="eye"></div>
				<div id="top-nav" class="inner flex flex-vert-center flex-space-between relative">
					<div class="logo"><a href="/"><img src="/img/logo-white.svg" alt=""></a></div>
					<div class="mobile-nav-icon">
						<img class="toggle-icon" src="/img/hamburger-nav.svg">
					</div>
					
					<ul class="nav-links flex flex-vert-center flex-space-between">
						<li>
							<a class="nav-link">Get Started</a>
							<ul class="sub-menu bg-white">
								<li class="pa-micro">
									<a href="/cassandra-basics/">
										<div class="sub-nav-icon">
											<img src="/img/sub-menu-basics.png" alt="cassandra basics icon">
										</div>
										<div class="sub-nav-text teal py-small">
											Cassandra Basics
										</div>
									</a>
								</li>
								<li class="pa-micro">
									<a href="/quickstart/">
										<div class="sub-nav-icon">
											<img src="/img/sub-menu-rocket.png" alt="cassandra basics icon">
										</div>
										<div class="sub-nav-text teal py-small">
											Quickstart
										</div>
									</a>
								</li>
								<li class="pa-micro">
									<a href="/ecosystem/">
										<div class="sub-nav-icon">
											<img src="/img/sub-menu-ecosystem.png" alt="cassandra basics icon">
										</div>
										<div class="sub-nav-text teal py-small">
											Ecosystem
										</div>
									</a>
								</li>
							</ul>
						</li>
						<li><a class="nav-link" href="https://cassandra.apache.org/doc/latest/">Documentation</a></li>
						<li>
							<a class="nav-link" href="/community/">Community</a>
							<ul class="sub-menu bg-white">
								<li class="pa-micro">
									<a href="/community/#code-of-conduct">
										<div class="sub-nav-icon">
											<img src="/img/sub-menu-welcome.png" alt="welcome icon">
										</div>
										<div class="sub-nav-text teal py-small">
											Welcome
										</div>
									</a>
								</li>
								<li class="pa-micro">
									<a href="/community/#discussion">
										<div class="sub-nav-icon">
											<img src="/img/sub-menu-discussions.png" alt="discussions icon">
										</div>
										<div class="sub-nav-text teal py-small">
											Discussions
										</div>
									</a>
								</li>
								<li class="pa-micro">
									<a href="/community/#project-governance">
										<div class="sub-nav-icon">
											<img src="/img/sub-menu-governance.png" alt="Governance icon">
										</div>
										<div class="sub-nav-text teal py-small">
											Governance
										</div>
									</a>
								</li>
								<li class="pa-micro">
									<a href="/community/#how-to-contribute">
										<div class="sub-nav-icon">
											<img src="/img/sub-menu-contribute.png" alt="Contribute icon">
										</div>
										<div class="sub-nav-text teal py-small">
											Contribute
										</div>
									</a>
								</li>
								<li class="pa-micro">
									<a href="/community/#meet-the-community">
										<div class="sub-nav-icon">
											<img src="/img/sub-menu-community.png" alt="Meet the Community icon">
										</div>
										<div class="sub-nav-text teal py-small">
											Meet the Community
										</div>
									</a>
								</li>
							</ul>
						</li>
						<li>
							<a class="nav-link">Learn</a>
							<ul class="sub-menu bg-white">
								<li class="pa-micro">
									<a href="/case-studies/">
										<div class="sub-nav-icon">
											<img src="/img/sub-menu-case-study.png" alt="Case Studies icon">
										</div>
										<div class="sub-nav-text teal py-small">
											Case Studies
										</div>
									</a>
								</li>
								<li class="pa-micro">
									<a href="/resources/">
										<div class="sub-nav-icon">
											<img src="/img/sub-menu-resources.png" alt="Resources icon">
										</div>
										<div class="sub-nav-text teal py-small">
											Resources
										</div>
									</a>
								</li>
								<li class="pa-micro">
									<a href="/blog/">
										<div class="sub-nav-icon">
											<img src="/img/sub-menu-blog.png" alt="Blog icon">
										</div>
										<div class="sub-nav-text teal py-small">
											Blog
										</div>
									</a>
								</li>
							</ul>
						</li>
						<li><a class="nav-link btn btn--filled" href="/download/">Download Now</a></li>
					</ul>
					
				</div>
				<div class="text-center flex flex-center flex-column relative z2 ma-xlarge">
					<h1 class="ma-large">
                        Testing Apache Cassandra 4.0
                    </h1>
					<h3> August 21, 2018 | The Apache Cassandra Community</h3> 
				</div>
			</header>
			<section id="blog-post" class="arrow py-xlarge">
				<div class="inner">
                    <hr>
                    <p>With the goal of ensuring reliability and stability in Apache Cassandra 4.0, the project’s committers have voted to freeze new features on September 1 to concentrate on testing and validation before cutting a stable beta. Towards that goal, the community is investing in methodologies that can be performed at scale to exercise edge cases in the largest Cassandra clusters. The result, we hope, is to make Apache Cassandra 4.0 the best-tested and most reliable major release right out of the gate.</p>

                    <p>In the interests of communication (and hopefully more participation), here’s a look at some of the approaches being used to test Apache Cassandra 4.0:</p>

                    <hr>

                    <h4 id="replay-testing">Replay Testing</h4>
                    <h5 id="workload-recording-log-replay-and-comparison">Workload Recording, Log Replay, and Comparison</h5>

                    <p>Replay testing allows for side-by-side comparison of a workload using two versions of the same database. It is a black-box technique that answers the question, “did anything change that we didn’t expect?”</p>

                    <p>Replay testing is simple in concept: record a workload, then re-issue it against two clusters – one running a stable release and the second running a candidate build. Replay testing a stateful distributed system is more challenging. For a subset of workloads, we can achieve determinism in testing by grouping writes by CQL partition and ordering them via client-supplied timestamps. This also allows us to achieve parallelism, as recorded workloads can be distributed by partition across an arbitrarily-large fleet of writers. Though linearizing updates within a partition and comparing differences does not allow for validation of all possible workloads (e.g., CAS queries), this subset is very useful.</p>

                    <p>The suite of Full Query Logging (“FQL”) tools in Apache Cassandra enable workload recording. <a target="_blank" href="https://issues.apache.org/jira/browse/CASSANDRA-14618">CASSANDRA-14618</a> and <a target="_blank" href="https://issues.apache.org/jira/browse/CASSANDRA-14619">CASSANDRA-14619</a> will add fqltool replay and fqltool compare, enabling log replay and comparison. Standard tools in the Apache ecosystem such as <a target="_blank" href="https://spark.apache.org">Apache Spark</a> and <a target="_blank" href="https://mesos.apache.org">Apache Mesos</a> can also make parallelizing replay and comparison across large clusters of machines straightforward.</p>

                    <hr>

                    <h4 id="fuzz-testing-and-property-based-testing">Fuzz Testing and Property-Based Testing</h4>
                    <h5 id="dynamic-test-generation-and-fuzzing">Dynamic Test Generation and Fuzzing</h5>

                    <p>Fuzz testing dynamically generates input to be passed through a function for validation. We can make fuzz testing smarter in stateful systems like Apache Cassandra to assert that persisted data conforms to the database’s contracts: acknowledged writes are not lost, deleted data is not resurrected, and consistency levels are respected. Fuzz testing of storage systems to validate these properties requires maintaining a record of responses received from the system; the development of a model representing valid legal states of data within the database; and a validation pass to assert that responses reflect valid states according to that model.</p>

                    <p>Property-based testing combines fuzz testing and assertions to explore a state space using randomly-generated input. These tests provide dynamic input to the system and assert that its fundamental properties are not violated. These properties can range from generic (e.g., “I can write data and read it back”) to specific (“range tombstone bounds synthesized during short-read-protection reads are properly closed”); and from local to distributed (e.g., “replacing every single node in a cluster results in an identical database”). To simplify debugging, property-based testing libraries like <a target="_blank" href="https://github.com/ncredinburgh/QuickTheories">QuickTheories</a> also provide a “shrinker,” which attempts to generate the simplest possible failing case after detecting input or a sequence of actions that triggers a failure.</p>

                    <p>Unlike model checkers, property-based tests don’t exhaust the state space – but explore it until a threshold of examples is reached. This allows for the computation to be distributed across many machines to gain confidence in code and infrastructure that scales with the amount of computation applied to test it.</p>

                    <hr>

                    <h4 id="distributed-tests-and-fault-injection-testing">Distributed Tests and Fault-Injection Testing</h4>
                    <h5 id="validating-behavior-under-fault-scenarios">Validating Behavior Under Fault Scenarios</h5>

                    <p>All of the above techniques can be combined with fault injection testing to validate that the system maintains availability where expected in fault scenarios, that fundamental properties hold, and that reads and writes conform to the system’s contracts. By asserting series of invariants under fault scenarios using different techniques, we gain the ability to exercise edge cases in the system that may reveal unexpected failures in extreme scenarios. Injected faults can take many forms – network partitions, process pauses, disk failures, and more.</p>

                    <hr>

                    <h4 id="upgrade-testing">Upgrade Testing</h4>
                    <h5 id="ensuring-a-safe-upgrade-path">Ensuring a Safe Upgrade Path</h5>

                    <p>Finally, it’s not enough to test one version of the database. Upgrade testing allows us to validate the upgrade path between major versions, ensuring that a rolling upgrade can be completed successfully, and that contents of the resulting upgraded database is identical to the original. To perform upgrade tests, we begin by snapshotting a cluster and cloning it twice, resulting in two identical clusters. One of the clusters is then upgraded. Finally, we perform a row-by-row scan and comparison of all data in each partition to assert that all rows read are identical, logging any deltas for investigation. Like fault injection tests, upgrade tests can also be thought of as an operational scenario all other types of tests can be parameterized against.</p>

                    <hr>

                    <h4 id="wrapping-up">Wrapping Up</h4>

                    <p>The Apache Cassandra developer community is working hard to deliver Cassandra 4.0 as the most stable major release to date, bringing a variety of methodologies to bear on the problem. We invite you to join us in the effort, deploying these techniques within your infrastructure and testing the release on your workloads. Learn more about how to get involved <a href="http://cassandra.apache.org/community/">here</a>.</p>

                    <p>The more that join, the better the release we’ll ship together.</p>

                    
				</div>
			</section>
			<footer class="grad grad--two flex-center pb-xlarge">
				<div class="inner text-center z2 relative">
					<h2 class="white py-small">Get started with Cassandra, fast.</h2>
					<a href="/quickstart/" class="btn btn--filled ma-medium">Quickstart Guide</a>
				</div>
				<div class="inner flex flex-distribute-items mt-xlarge z2 relative">
					<div class="col-2">
						<div class="logo mb-medium"><img src="/img/logo-white.svg" alt=""></div>
						<p>Apache Cassandra powers mission-critical deployments with improved performance and unparalleled levels of scale in the cloud.</p>
					</div>
					<div class="col-2 flex flex-center">
						<ul class="columns-2">
							<li class="mb-small"><a href="/">Home</a></li>
							<li class="mb-small"><a href="/cassandra-basics/">Cassandra Basics</a></li>
							<li class="mb-small"><a href="/quickstart/">Quickstart</a></li>
							<li class="mb-small"><a href="/ecosystem/">Ecosystem</a></li>
							<li class="mb-small"><a href="https://cassandra.apache.org/doc/latest/">Documentation</a></li>
							<li class="mb-small"><a href="/community/">Community</a></li>
							<li class="mb-small"><a href="/case-studies/">Case Studies</a></li>
							<li class="mb-small"><a href="/resources/">Resources</a></li>
							<li class="mb-small"><a href="/blog/">Blog</a></li>
							
						</ul>
					</div>
				</div>
			</footer>
			<div class="lower-footer bg-white pa-medium">
				<div class="flex flex-row flex-vert-center">
					<div class="pr-medium"><img src="../img/feather-small.png" alt="ASF" width="20"></div>
					<div class="pr-medium"><a href="http://www.apache.org/" target="_blank">Foundation</a></div>
					<div class="pr-medium"><a href="https://www.apache.org/events/current-event.html" target="_blank">Events</a></div>
					<div class="pr-medium"><a href="https://www.apache.org/licenses/" target="_blank">License</a></div>
					<div class="pr-medium"><a href="https://www.apache.org/foundation/thanks" target="_blank">Thanks</a></div>
					<div class="pr-medium"><a href="https://www.apache.org/security" target="_blank">Security</a></div>
					<div class="pr-medium"><a href="https://www.apache.org/foundation/sponsorship" target="_blank">Sponsorship</a></div>
				</div>
				<p class="my-medium">&copy; <script>document.write(new Date().getFullYear())</script> <a href="https://apache.org" target="_blank">The Apache Software Foundation</a> under the terms of the Apache License 2.0. Apache, the Apache feather logo, and Apache Cassandra are trademarks of The Apache Software Foundation.</p>
			</div>
		</div>
                <div id="fade" class="hidden"></div>
			<div id="modal" class="modal hidden">
				<div id="close-modal" class="cursor-pointer"><svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div>
				<div id="mod-content" class="vid-mod-content resp-container">
			</div>
		</div>
	</body>
</html>